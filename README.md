# rickascii-ps
**It doesn’t matter what platform you use. He still won’t run around and desert you.**

[Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0.html)

Inspired by the lack of a reaction from people pranked by my horribly written [rickascii](https://github.com/kirb/rickascii) (C program running under Tiny Core Linux) last year, and after stumbling upon Lee Holmes’ [similar script for PowerShell](http://www.leeholmes.com/blog/2011/04/01/powershell-and-html5/), I decided I’d try something I thought I’d never achieve: learn PowerShell, learn enough PowerShell to reimplement rickascii in it, and have rickascii not suck so much.

I present to you **rickascii-ps**, perfectly ideal for your secret install of Windows 7 Professional with the [shell](http://technet.microsoft.com/en-us/library/cc939851.aspx) set to `powershell.exe` and the screen resolution to 640x480. This is essentially provided as-is, and if it gets improved it’s probably because I couldn’t think of a better prank to pull in a following year.

You might notice there’s still some C, `rickexe.c`. Interop with Win32 APIs seemed really confusing and with only a short amount of time left, I decided I just had to resort to a C program doing the work of removing the `WS_SYSMENU` flag from the console window (which hides the window icon and close/maximize/minimize controls). So yeah... you need to compile that with MinGW’s `gcc`. (Sorry.)

Unlike last year, I’ve included `rickascii.frames` within the repo. The first problem is that Windows console has a flaw, at least to anyone used to fancy modern encodings such as UTF-8: it’s stuck using [code page 437](https://en.wikipedia.org/wiki/Code_page_437) encoding (and 16 colors...) to emulate the IBM PC. The easiest fix is to take the output from [hiptext](https://github.com/jart/hiptext) as instructed in [last year’s instructions](https://github.com/kirb/rickascii/blob/master/README.md) and re-save it as CP 437. The block characters are lost, but the replacements suffice (to me at least). What’s left? Escape sequences. We can take those out; the PowerShell script can handle that. Finally, the frame is 80x25, with two black “pixels” in the last two columns. We must have less than the number of columns in the console, otherwise a new line will be created after each, completely ruining it. You can kill two birds with one stone by removing those two last columns and then adding a space before every line to “center” them. To make your life easier, should you be crazy enough to use this, I’ve included my working frames file.

You still need to provide the audio. I’m not going to risk letting Sony DMCA my GitHub repo. Unless you’ve spent sweet time stripping down Windows in any way, compressing this probably won’t achieve all that much. However, we’re talking *Windows* here, so unlike [last year](https://github.com/kirb/rickascii/blob/master/README.md), go right ahead and use GSM encoding for the audio. 461 KB is definitely better than 2.3 MB.

When you’re ready to do your deed, open the Registry Editor and find your way through to `HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon`. Here, you can change the `Shell` key from `explorer.exe` to `powershell.exe`. Logging on will now throw you directly into a PowerShell prompt. Go through to your Documents directory, create a directory called `WindowsPowerShell`, and in there create `profile.ps1`. You’ll want to `Set-Location` to where you put the rickascii files (I used `C:\Users\Public\Documents`), and run .\rickascii.ps1. That’s it, have fun, and most importantly don’t get me sued.
